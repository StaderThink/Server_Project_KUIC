@layout AppLayout
@inject NavigationManager navegador
@inject HttpClient http  

@using Aplicacion.Modelo.Inventarios
@page "/entrada/registrar"

<h3>Registrar entrada</h3>

<form @onsubmit="Enviar">
    <div class="control">
        <button class="button is-prime" @onclick="AgregarElemento">+ Detalle</button>
    </div>

    <div class="field">
        @foreach (var detalle in detalles)
        {
            <ItemDetalle detalle="detalle" OnDeleted="EliminarElemento" />
        }
    </div>

    <div class="field">
        <label for="observacion">Observación</label>
        <input id="observacion" class="input" type="text" @bind="entrada.Observacion" />
    </div>

    <div class="control is-grouped">
        <button class="is-prime">Registrar</button>
        <a href="/entrada" class="button is-outline">Cancelar</a>
    </div>

</form>

@code {
    Entrada entrada { get; set; } = new Entrada();

    List<DetalleEntrada> detalles = new List<DetalleEntrada>();

    private void AgregarElemento()
    {
        detalles.Add(new DetalleEntrada());
    }

    private void EliminarElemento(DetalleEntrada detalle)
    {
        detalles.Remove(detalle);
    }

    async Task Enviar()
    {
        var formulario = new FormularioRegistrarEntrada()
        {
            Entrada = entrada,
            Detalle = detalles
        };

        var respuesta = await http.PostAsJsonAsync("/api/entrada", formulario);

        if (respuesta.IsSuccessStatusCode)
        {
            navegador.NavigateTo("/entrada");
        }

    }
}
